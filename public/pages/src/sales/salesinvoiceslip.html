<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Sales Invoice</title>

    <link rel="stylesheet" href="../../../css/style.css">
    <link rel="stylesheet" href="../../../css/salesStyle.css">

    <!-- bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
        crossorigin="anonymous">
    <!-- Font Awesome -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js" integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ"
        crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js" integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY"
        crossorigin="anonymous"></script>
</head>

<body>
    <div class="nav-side-menu">
        <div class="brand brand-color">
            <h5>Abbas Ali & Sons Uniforms and Textiles</h5>
        </div>
        <i class="fa fa-bars fa-2x toggle-btn" data-toggle="collapse" data-target="#menu-content"></i>
        <div class="menu-list" id="menu-content">

                <ul id="accordion1" class="menu-content collapse out">

                        <li data-toggle="collapse" data-parent="#accordion1" href="#thirdLink"> <a> <i></i> Sales</a>
        
                            <ul id="thirdLink" class="collapse sub-list">
                                <li>
                                    <a href="/sale/sales_order">Sales Order</a>
                                </li>
                                <li>
                                    <a href="/sale/packing_list">Packing List</a>
                                </li>
                                <li>
                                    <a href="/sale/commercial_invoice">Commercial Invoice</a>
                                </li>
                                <li>
                                    <a href="/sale/reciept_voucher">Reciept Voucher</a>
                                </li>
                            </ul>
                        </li>
                        <li data-toggle="collapse" data-parent="#accordion1" href="#firstLink"> <a> <i></i> Purchase</a>
        
                            <ul id="firstLink" class="collapse sub-list">
                                <li>
                                    <a href="/purchase/purchase_order">Purchase Order</a>
                                </li>
                                <li>
                                    <a href="/purchase/gr_note">Good Receiving Note / Invoice</a>
                                </li>
        
                                <li>
                                    <a href="/purchase/payment_voucher">Vendor Payment</a>
                                </li>
                            </ul>
        
                        </li>
                        <li>
                            <a href="/production">
                                <i></i> Production</a>
                        </li>
                        <li data-toggle="collapse" data-parent="#accordion1" href="#reports"> <a> <i></i> Reports</a>
        
                            <ul id="reports" class="collapse sub-list">
                                <li>
                                    <a href="/reports/sales_report">Sales Report</a>
                                </li>
                                <li>
                                    <a href="/reports/purchase_report">Purchases Report</a>
                                </li>
        
                                <li>
                                    <a href="/reports/production_report">Productions Report</a>
                                </li>
                                <li>
                                    <a href="/reports/accounts_report">Accounts Report</a>
                                </li>
                            </ul>
        
                        </li>
        
                        <li>
                            <a href="/master">
                                <i></i> Master Data
                            </a>
                        </li>
        
                        <li>
                            <a href="/master_view">
                                <i></i> Master View
        
                            </a>
                        </li>
        
                        <!-- <li>
                                <a href="/attendance">
                                    <i></i> Attendance
                                </a>
                            </li> -->
        
                    </ul>
        

        </div>
    </div>

    <div id="main" class="wrapper container-fluid">

        <div id="content" class="container-fluid">

            <div class="container sales-container" id="main_place">

                <div class="row">
                    <div class="col-12">
                        <img src="../../../assets/img/aa-logo.jpg" class="rounded float-right md-logo" alt="logo">
                    </div>
                </div>

                <div class="packing-slip-header">

                    <div class="row">

                        
                        <div class="col-6">
                            <h3>Sales Invoice</h3>
                            <br>
                            <div class="row">
                                <div class="col-4">
                                    Invoice #
                                </div>
                                <div class="col-8">
                                    <select  class="form-control" id="invoice_ref" onchange="set_invoice(this)">

                                    </select>   
                                </div>
                            </div>
                            <br>
                            
                        </div>
                    </div>
                </div>
                <div class="bill-info row">
                    <div class="col-6">
                        <h4>Shipping Info</h4>
                    <div class="form-inline">
                        <label class="form-control-label">Shipment Mode:</label>
                        <input type="text" class="form-control" id="sm" />
                    </div>
                    <div class="form-inline">
                            <label class="form-control-label">Freight Terms:</label>
                            <input type="text" class="form-control" id="ft" />
                    </div>
                    <div class="form-inline">
                            <label class="form-control-label">Origin:</label>
                            <input type="text" class="form-control" id="o" />
                    </div>
                    <div class="form-inline">
                            <label class="form-control-label">Port of loading:</label>
                            <input type="text" class="form-control" id="pol" />
                    </div>
                    <div class="form-inline">
                            <label class="form-control-label">Port of Discharge:</label>
                            <input type="text" class="form-control" id="pod" />
                    </div>
                    <div class="form-inline">
                            <label class="form-control-label">Place of delivery:</label>
                            <input type="text" class="form-control" id="plod" />
                    </div><br><Br><br>
                </div>
                </div>
                <div class="row">
                        <div class="col-4"></div>
                        <div class="col-8"> 
                            <button class='btn btn-primary' disabled="true" id='btn' onClick="generate_sales_invoice(this)">Generate Sales Invoice</button>
                        </div>
                    </div> 
               

              
            </div>

           


        </div>


    </div>

</body>
<script>
    var invoices;
    function generate_sales_invoice(e){
        let invoice_ref = document.getElementById('invoice_ref').value,
            sm = document.getElementById('sm').value,
            o = document.getElementById('o').value,
            ft = document.getElementById('ft').value,
            pod = document.getElementById('pod').value,
            plod = document.getElementById('plod').value,
            pol = document.getElementById('pol').value;
            if(sm === "" || o==="" || ft==="" || pod==="" || plod==="" || pol==="")
            {
                alert("please fill all fields");
            }
            else{
                e.disabled = true;
                console.log("starting");
                var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    alert("Sales Invoice is Generated");
                    e.disabled = false;
                   
                    var link = document.createElement("a");
                    link.download = 'sales_invoice.xlsx';
                     link.href = '/sales_invoice_report';
                     link.click();
                     document.location.reload();
                }
            }
            xhttp.open("POST", "/generate_sales_invoice", true);
            xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            xhttp.send("ref="+invoice_ref+"&sm="+sm+"&o="+o+
            "&ft="+ft+"&pod="+pod+"&plod="+plod+"&pol="+pol);

            }

    }
    function set_invoice(e){
        if(e.value !== "")
        {
            document.getElementById('btn').disabled = false
        }
        else{
            document.getElementById('btn').disabled = true
        }
    }
 let client, lpos;
    function fill() {


        //// lpos get 
        var xhttp3 = new XMLHttpRequest();
        xhttp3.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                invoices = JSON.parse(this.responseText).invoices;
                str = '<option value="">Select Invoice</option>';
                // alert(e.innerHTML.length)
                invoices.reverse().forEach((invoice) => {
                    str += `<option value="` + invoice.ref + `">` + invoice.ref + `</option>`;
                });
                document.getElementById('invoice_ref').innerHTML = str;

                console.log(invoices)
            }
        };
        xhttp3.open("GET", "/get_invoices", true);
        xhttp3.send();


    }
    fill();
    
</script>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
    crossorigin="anonymous"></script>

<script src="../../../js/app.js"></script>

<script>
  //  let index = 1;



</script>

</html>