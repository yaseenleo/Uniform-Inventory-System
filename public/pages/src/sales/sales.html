<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Sales Order</title>

    <link rel="stylesheet" href="../../../css/style.css">
    <link rel="stylesheet" href="../../../css/salesStyle.css">

    <!-- bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
        crossorigin="anonymous">
    <!-- Font Awesome -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js" integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ"
        crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js" integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY"
        crossorigin="anonymous"></script>
</head>

<body onload="fill()">

    <div class="nav-side-menu">
        <div class="brand brand-color">
            <h5>Abbas Ali & Sons Uniforms and Textiles</h5>
        </div>
        <i class="fa fa-bars fa-2x toggle-btn" data-toggle="collapse" data-target="#menu-content"></i>
        <div class="menu-list" id="menu-content">

            <ul id="accordion1" class="menu-content collapse out">

                <li data-toggle="collapse" data-parent="#accordion1" href="#thirdLink"> <a> <i></i> Sales</a>

                    <ul id="thirdLink" class="collapse sub-list">
                        <li>
                            <a href="/sale/sales_order">Sales Order</a>
                        </li>
                        <li>
                            <a href="/sale/packing_list">Packing List</a>
                        </li>
                        <li>
                            <a href="/sale/commercial_invoice">Commercial Invoice</a>
                        </li>
                        <li>
                            <a href="/sale/reciept_voucher">Reciept Voucher</a>
                        </li>
                    </ul>
                </li>
                <li data-toggle="collapse" data-parent="#accordion1" href="#firstLink"> <a> <i></i> Purchase</a>

                    <ul id="firstLink" class="collapse sub-list">
                        <li>
                            <a href="/purchase/purchase_order">Purchase Order</a>
                        </li>
                        <li>
                            <a href="/purchase/gr_note">Good Receiving Note / Invoice</a>
                        </li>

                        <li>
                            <a href="/purchase/payment_voucher">Vendor Payment</a>
                        </li>
                    </ul>

                </li>
                <li>
                    <a href="/production">
                        <i></i> Production</a>
                </li>
                <li data-toggle="collapse" data-parent="#accordion1" href="#reports"> <a> <i></i> Reports</a>

                    <ul id="reports" class="collapse sub-list">
                        <li>
                            <a href="/reports/sales_report">Sales Report</a>
                        </li>
                        <li>
                            <a href="/reports/purchase_report">Purchases Report</a>
                        </li>

                        <li>
                            <a href="/reports/production_report">Productions Report</a>
                        </li>
                        <li>
                            <a href="/reports/accounts_report">Accounts Report</a>
                        </li>
                    </ul>

                </li>

                <li>
                    <a href="/master">
                        <i></i> Master Data
                    </a>
                </li>

                <li>
                    <a href="/master_view">
                        <i></i> Master View

                    </a>
                </li>

                <!-- <li>
                        <a href="/attendance">
                            <i></i> Attendance
                        </a>
                    </li> -->

            </ul>

        </div>
    </div>


    <div id="main" class="wrapper container-fluid">

        <div id="content" class="container-fluid">

            <h2 class="text-center">SALES ORDER</h2>

            <div class="container sales-container" id="main_place">

                <div class="row">
                    <div class="col-12">
                        <img src="../../../assets/img/aa-logo.jpg" class="rounded float-right md-logo" alt="logo">
                    </div>
                </div>

                <div class="packing-slip-header">

                    <div class="row">

                        <div class="col-6">
                            <h3>ABBAS ALI & SONS</h3>
                            <p><address id="address"></address></p> <!-- fetch address -->
                            <p><address id="city">karachi,pk</address></p> <!-- fetch city -->
                            <p>Phone: <span id="phone-no">+923452462819,+923452965650</span></p>
                            <!-- fetch phone number -->
                            <p>Tel: <span id="fax-no">+92-31-3-4242673</span></p> <!-- fetch fax number -->
                            <p>Website: <span id="phone-no">www.abbasaliandsons.com</span></p>
                            <!-- fetch website name of company -->

                        </div>

                        <div class="col-6">
                            <h3>Sales Order</h3>
                            <div class="row">
                                <div class="col-5">
                                    <p>Order Date:</p>
                                </div>
                                <div class="col-7">
                                    <input type="date" class="form-control" id="pur-date">
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-5">
                                    <p>Due Date(Upto):</p>
                                </div>
                                <div class="col-7">
                                    <input type="date" class="form-control" id="pur-date-2">
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-5">
                                    <p>Customer P.O#</p>
                                </div>
                                <div class="col-7">
                                    <input type="text" class="form-control" id="pur-po">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- packing address section -->
                <div class="supply-content">
                    <div class="row">
                        <div class="col-6">
                            <h3 class="main-subject">Bill To:</h3>

                            <div class="row">
                                <div class="col-5">
                                    <p>Company Name:</p>
                                </div>
                                <div class="col-7">
                                    <select name="vender-info" id="pur-company-name" class="form-control" onchange="fill_client()">

                                    </select>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-5">
                                    <p>Name:</p>
                                </div>
                                <div class="col-7">
                                    <input type="text" name="vender-info" id="pur-name" class="form-control">
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-5">
                                    <p>Street Address</p>
                                </div>
                                <div class="col-7">
                                    <input type="text" name="vender-info" id="pur-vender-address" class="form-control">
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-5">
                                    <p>City or ZIP:</p>
                                </div>
                                <div class="col-7">
                                    <input type="text" name="vender-info" id="pur-vender-city" class="form-control">
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-5">
                                    <p>Phone:</p>
                                </div>
                                <div class="col-7">
                                    <input type="text" name="vender-info" id="pur-vender-phone" class="form-control">
                                </div>
                            </div>

                        </div>

                        <div class="col-6">
                            <h3 class="main-subject">Ship To:</h3>
                            <div class="row">
                                <div class="col-5">
                                    <p>Name:</p>
                                </div>
                                <div class="col-7">
                                    <input type="text" name="ship-info" id="pur-ship-name" class="form-control">
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-5">
                                    <p>Company Name:</p>
                                </div>
                                <div class="col-7">
                                    <input type="text" name="ship-info" id="pur-ship-company-name" class="form-control">
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-5">
                                    <p>Street Address</p>
                                </div>
                                <div class="col-7">
                                    <input type="text" name="ship-info" id="pur-ship-address" class="form-control">
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-5">
                                    <p>City or ZIP:</p>
                                </div>
                                <div class="col-7">
                                    <input type="text" name="ship-info" id="pur-ship-city" class="form-control">
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-5">
                                    <p>Phone:</p>
                                </div>
                                <div class="col-7">
                                    <input type="text" name="ship-info" id="pur-ship-phone" class="form-control">
                                </div>
                            </div>

                        </div>

                    </div>
                </div>
                <table class='table table-bordered col-md-4'>
                    <thead>
                        <tr>
                            <th>Sales Tax %</th>
                            <th>Discount</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><input class='form-control' id='tax' type="number" value=0 min="0" max="30" /></td>
                            <td><input class="form-control" id='discount' type='number' value=0 min="0" max="999999" /></td>
                        </tr>
                    </tbody>
                </table>
                <table class="table table-bordered">
                    <thead>
                        <tr class="d-flex">
                            <td class="col-3">Product Category</td>
                            <td class="col-5">Description</td>
                            <td class="col-2">Order Qty</td>
                            <td class="col-2">Unit Price</td>
                        </tr>
                    </thead>
                    <tbody id="items_table">
                        <tr class="d-flex">
                            <td class="col-3 td-cells">
                                <select class="form-control" id="pro1category" onclick="load_items(this)" onchange="set_item(this)">
                                    <option>Select Product</option>
                                </select>
                            </td>
                            <td class="col-5 td-cells">
                                <input type="text" class="form-control" id="pro1description">
                            </td>
                            <td class="col-2 td-cells">
                                <input type="text" class="form-control" id="pro1quantityorder">
                            </td>
                            <td class="col-2 td-cells">
                                <input type="text" class="form-control" id="pro1unitprice" onkeypress="sales_add_new(event)">
                            </td>
                        </tr>
                    </tbody>
                </table>

                <section class="color-1 text-center">
                    <p>
                        <a class='btn btn-primary' data-toggle="modal" data-target="#myModal">Terms and Condition</a>
                        <button onclick="generate_lpo(this)" class="btn btn-primary " disabled id='lpo_btn'>Generate</button>

                        <!-- <button onclick="salesOrder('operation1')" class="btn btn-primary ">Generate</button> -->
                    </p>
                </section>

            </div>

            <div class="forms" style="max-width: none; display: none;" id="operation1">

                <div>

                    <div class="row">
                        <div class="col-12">
                            <img src="../../../assets/img/optimized-logo.png" class="rounded float-right md-logo" alt="logo">
                        </div>
                    </div>

                    <div class="packing-slip-header">

                        <div class="row">

                            <div class="col-6">
                                <h3>Company Name</h3>
                                <p><address id="address">Street Address</address></p> <!-- fetch address -->
                                <p><address id="city">City</address></p> <!-- fetch city -->
                                <p>Phone: <span id="phone-no"></span></p> <!-- fetch phone number -->
                                <p>Fax: <span id="fax-no"></span></p> <!-- fetch fax number -->
                                <p>Website: <span id="phone-no"></span></p> <!-- fetch website name of company -->

                            </div>

                            <div class="col-6">
                                <h3>Packing Slip</h3>
                                <div class="row">
                                    <div class="col-4">
                                        <p>Date:</p>
                                    </div>
                                    <div class="col-8">
                                        <p id="pur-date-g"></p>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-4">
                                        P.O #
                                    </div>
                                    <div class="col-8">
                                        <p id="pur-po-g"></p>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>

                    <!-- packing address section -->
                    <div class="supply-content">
                        <div class="row">
                            <div class="col-6">
                                <h3 class="main-subject">Bill To:</h3>
                                <div class="row">
                                    <div class="col-5">
                                        <p>Name:</p>
                                    </div>
                                    <div class="col-7">
                                        <p id="pur-name-g"></p>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-5">
                                        <p>Company Name:</p>
                                    </div>
                                    <div class="col-7">
                                        <p id="pur-company-name-g"></p>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-5">
                                        <p>Street Address</p>
                                    </div>
                                    <div class="col-7">
                                        <p id="pur-vender-address-g"></p>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-5">
                                        <p>City or ZIP:</p>
                                    </div>
                                    <div class="col-7">
                                        <p id="pur-vender-city-g"></p>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-5">
                                        <p>Phone:</p>
                                    </div>
                                    <div class="col-7">
                                        <p id="pur-vender-phone-g"></p>
                                    </div>
                                </div>

                            </div>

                            <div class="col-6">
                                <h3 class="main-subject">Ship To:</h3>
                                <div class="row">
                                    <div class="col-5">
                                        <p>Name:</p>
                                    </div>
                                    <div class="col-7">
                                        <p id="pur-ship-name-g"></p>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-5">
                                        <p>Company Name:</p>
                                    </div>
                                    <div class="col-7">
                                        <p id="pur-ship-company-name-g"></p>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-5">
                                        <p>Street Address</p>
                                    </div>
                                    <div class="col-7">
                                        <p id="pur-ship-address-g"></p>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-5">
                                        <p>City or ZIP:</p>
                                    </div>
                                    <div class="col-7">
                                        <p id="pur-ship-city-g"></p>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-5">
                                        <p>Phone:</p>
                                    </div>
                                    <div class="col-7">
                                        <p id="pur-ship-phone-g"></p>
                                    </div>
                                </div>

                            </div>

                        </div>
                    </div>

                </div>

                <!-- product list section -->
                <table class="table table-bordered">
                    <thead>
                        <tr class="d-flex">
                            <td class="col-1">S.no</td>
                            <td class="col-2">Product Category</td>
                            <td class="col-4">Description</td>
                            <td class="col-1">Avail Qty</td>
                            <td class="col-1">Order Qty</td>
                            <td class="col-1">Unit Price</td>
                            <td class="col-2">Total Price</td>
                        </tr>

                    <tbody id="create-lists">

                    </tbody>
                    </thead>
                </table>

            </div>


        </div>


    </div>
    <!--- modal-->
    <!-- The Modal -->
    <div class="modal" id="myModal">
        <div class="modal-dialog">
            <div class="modal-content">

                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title">Terms and Conditions</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <!-- Modal body -->
                <div class="modal-body">
                    <p id="sales_terms">Loading....</p>

                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" onclick="activate_btn()" data-dismiss="modal">Accept
                        Terms & Conditions</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                </div>

            </div>
        </div>
    </div>

    <!---  modal-->
    <!-- <p id="n"></p> -->
    <!-- <button onclick="waqaskhan();">Submit</button>
<input type="button" id="create_pdf" value="Generate PDF">  -->

</body>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
    crossorigin="anonymous"></script>

<script src="../../../js/app.js"></script>

<script>
    let clients, items, styles;
    function fill() {
        let select_client = document.getElementById('pur-company-name');
        document.getElementById('pur-po').value = Math.floor(Math.random() * 100000);

        let select_item = document.getElementById('pro1category');
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                let str = '<option value="null">Select Company</option>';
                clients = JSON.parse(this.responseText).clients;
                clients.forEach(client => {
                    str += `<option value='` + client.company_name + `'>` + client.company_name + `</option>`
                });
                select_client.innerHTML = str;
                console.log(clients);
            }
        };
        xhttp.open("GET", "/get_clients", true);
        xhttp.send();
        var xhttp2 = new XMLHttpRequest();
        xhttp2.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                let str = '<option value="null">Select Product</option>';
                items = JSON.parse(this.responseText).items;
                items.forEach(item => {
                    str += `<option value='` + item.name + `'>` + item.name + `</option>`
                });
                select_item.innerHTML = str;
                console.log(items);
            }
        };
        xhttp2.open("GET", "/get_items", true);
        xhttp2.send();

        var xhttp3 = new XMLHttpRequest();
        xhttp3.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                document.getElementById("sales_terms").innerHTML = JSON.parse(this.responseText).info[0].sales_terms
            }
        };
        xhttp3.open("GET", "/get_info", true);
        xhttp3.send();

      
    }
    function activate_btn() {
        document.getElementById('lpo_btn').disabled = false;
    }
    function set_item(e) {
        // alert(e.value);
        let value = e.value;
        let detail = e.parentNode.parentNode.getElementsByTagName('td')[1].getElementsByTagName('input')[0];
        let price = e.parentNode.parentNode.getElementsByTagName('td')[3].getElementsByTagName('input')[0];

        items.forEach((item) => {
            if (item.name === value) {
                detail.value = item.detail;
                price.value = item.price;
            }
        })
    }
    function load_items(e) {
        let str = '<option value="null">Select Product</option>';
        console.log(items);
        if (e.innerHTML.length < 10) {
            items.forEach((item) => {
                str += `<option>` + item.name + `</option>`;
            });
            e.innerHTML = str;
        }



    }

    function fill_client() {
        let name = document.getElementById('pur-company-name').value;
        if (name === "null") {
            document.getElementById('pur-name').value = '';
            document.getElementById('pur-vender-address').value = '';
            document.getElementById('pur-vender-city').value = '';
            document.getElementById('pur-vender-phone').value = '';
            document.getElementById('pur-ship-phone').value = '';
            document.getElementById('pur-ship-name').value = '';
            document.getElementById('pur-ship-address').value = '';
            document.getElementById('pur-ship-city').value = '';
            document.getElementById('pur-ship-company-name').value = '';



        }
        else {
            clients.forEach((client) => {
                if (name === client.company_name) {
                    document.getElementById('pur-name').value = client.name;
                    document.getElementById('pur-ship-name').value = client.name;
                    document.getElementById('pur-vender-address').value = client.street;
                    document.getElementById('pur-ship-address').value = client.street;
                    document.getElementById('pur-vender-city').value = client.city;
                    document.getElementById('pur-ship-city').value = client.city;
                    document.getElementById('pur-vender-phone').value = client.phone;
                    document.getElementById('pur-ship-phone').value = client.phone;
                    document.getElementById('pur-ship-company-name').value = client.company_name;

                }
            })

        }

    }
    function generate_lpo(e) {
        e.disabled = true;
        let pur_name = document.getElementById('pur-name').value;
        let pur_vendor_address = document.getElementById('pur-vender-address').value;
        let pur_vendor_city = document.getElementById('pur-vender-city').value;
        let pur_vendor_phone = document.getElementById('pur-vender-phone').value;
        let pur_company_name = document.getElementById('pur-company-name').value;
        let pur_ship_name = document.getElementById('pur-ship-name').value;
        let pur_ship_address = document.getElementById('pur-ship-address').value;
        let pur_ship_city = document.getElementById('pur-ship-city').value;
        let pur_ship_phone = document.getElementById('pur-ship-phone').value;
        let pur_ship_company_name = document.getElementById('pur-ship-company-name').value;

        let lpo_number = document.getElementById('pur-po').value;
        let date = document.getElementById('pur-date').value;
        let due_date = document.getElementById('pur-date-2').value;
        let ref = "lpo/" + pur_company_name + "/" + lpo_number;
        if (pur_company_name.length < 2 || pur_ship_name.length < 2 || pur_ship_company_name.length < 2 || date.length < 2) {
            alert('please fill all fields');

        }
        else {
            let items_array = [], total = 0;
            let table = document.getElementById('items_table');
            console.log("table:" + table);
            let tr = table.getElementsByTagName('tr');
            let item, description, quantity, price, obj;
            let tax = document.getElementById("tax").value;
            let discount = document.getElementById("discount").value;
            for (let i = 0; i < tr.length; i++) {
                item = tr[i].getElementsByTagName('td')[0].getElementsByTagName('select')[0].value;
                description = tr[i].getElementsByTagName('td')[1].getElementsByTagName('input')[0].value;
                quantity = tr[i].getElementsByTagName('td')[2].getElementsByTagName('input')[0].value;
                price = tr[i].getElementsByTagName('td')[3].getElementsByTagName('input')[0].value;

                obj = { item: item, description: description, quantity: quantity, price: price };
                total += quantity * price;
                items_array.push(obj);

            };
            total = total + (total * (tax / 100));
            total = total - discount;
            items_array = JSON.stringify(items_array);
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    alert("Sales Order is Generated");
                    e.disabled = false;

                    var link = document.createElement("a");
                    link.download = 'sales order.xlsx';
                    link.href = '/sales_order_report';
                    link.click();
                    document.location.reload();
                }
            };
            xhttp.open("POST", "/add_lpo", true);
            xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            xhttp.send("client=" + pur_company_name + "&lpo_num=" + lpo_number + "&date=" + date + "&due_date=" + due_date + "&ref=" + ref + "&items_array=" + items_array + "&total=" + total + "&tax=" +
                tax + "&discount=" + discount + "&pur_name=" + pur_name + "&v_address=" + pur_vendor_address + "&v_city=" + pur_vendor_city + "&v_phone=" +
                pur_vendor_phone + "&s_name=" + pur_ship_name + "&s_address=" + pur_ship_address + "&s_city=" + pur_ship_city +
                "&s_phone=" + pur_ship_phone + "&pur_ship_company_name=" + pur_ship_company_name);



        }

    }




</script>

</html>